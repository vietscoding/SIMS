@model SIMS.ViewModels.AcademicProgramViewModel

@{
    Layout = "_AdminLayout";
}

<div class="actionBtnBox">
    <h2>Academic Programs</h2>
    <button id="filterProgramsBtn" type="button" class="btn btn-primary" style="margin-bottom: 1vh;">Filter Academic Programs</button>
    <button id="addProgramBtn" class="btn btn-success" style="margin-bottom: 1vh;">Add a New Academic Programs</button>
    <hr />
</div>

<div style="max-width: 100%; overflow-x: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: #fafafa;">

    <table class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>Action</th>
                <th>ID</th>
                <th>Name</th>
                <th>Major</th>
                <th>Faculty</th>
                <th>Language</th>
                <th>Description</th>
                <th>Number of Semesters</th>
                <th>Total</th>
                <th>Obligated Credits</th>
                <th>Elective Credits</th>
                @* <th>Created At</th> *@
                @* <th>Updated At</th> *@
                @* <th>Is Deleted</th> *@
            </tr>
        </thead>
        <tbody>
            @foreach (var p in Model.AcademicPrograms)
            {
                <tr>
                    <td>
                        <button class="btn btn-info btn-sm view-details" data-id="@p.AcademicProgramId">View</button>
                    </td>
                    <td>@p.AcademicProgramId</td>
                    <td>
                        <a href="#" class="view-details" data-id="@p.AcademicProgramId">
                            @(p.AcademicProgramName ?? "N/A")
                        </a>
                    </td>

                    <td>
                        @if (p.Major == null || string.IsNullOrEmpty(p.Major.MajorName))
                        {
                            @Html.Raw("<em>Not set yet</em>")
                        }
                        else
                        {
                            @p.Major.MajorId
                        }
                    </td>

                    <td>
                        @if (p.Faculty == null || string.IsNullOrEmpty(p.Faculty.FacultyName))
                        {
                            @Html.Raw("<em>Not set yet</em>")
                        }
                        else
                        {
                            @p.Faculty.FacultyName
                        }
                    </td>

                    <td>@(p.Language ?? "N/A")</td>
                    <td>@(string.IsNullOrEmpty(p.Description) ? @Html.Raw("<em>Not set yet</em>") : (p.Description.Length > 50 ? p.Description.Substring(0, 50) + "..." : p.Description))</td>
                    <td>@p.NumberOfSemester</td>
                    <td>@p.TotalOfRequiredCredits</td>
                    <td>@p.ObligatedCredits</td>
                    <td>@p.ElectiveCredits</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@* Add New Program Modal*@
<div id="addProgramModal" class="user-modal">
    <div class="user-modal-content">
        <span class="close-modal" id="closeAddProgramModal">&times;</span>
        <h3>Add New Program</h3>
        <div class="row g-3" style="margin-top:12px;">
            <div class="col-md-6">
                <label for="programName" class="form-label">Program Name</label>
                <input type="text"
                       class="form-control"
                       id="programName"
                       placeholder="a program name" />
            </div>

            <div class="col-md-6">
                <label for="major" class="form-label">Major</label>
                <input type="text"
                       class="form-control"
                       id="major"
                       list="majorList" />
                <datalist id="majorList">
                    <option>Any</option>
                    <input type="hidden" id="majorId" name="majorId" value="" />
                </datalist>
            </div>

            <div class="col-md-6">
                <label for="language" class="form-label">Language</label>
                <input type="text"
                       class="form-control"
                       id="language"
                       placeholder="e.g., Vietnamese" />
            </div>

            <div class="col-md-6">
                <label for="numberOfSemesters" class="form-label">Number of semesters</label>
                <input type="text"
                       class="form-control"
                       id="numberOfSemesters"
                       required
                       placeholder="a positve integer required" />
            </div>

            <div class="col-md-5">
                <label for="obligatedCredits" class="form-label">Obligated Credits</label>
                <input type="number"
                       class="form-control"
                       id="obligatedCredits"
                       placeholder="a positive number required"
                       value="0"
                       min="0"
                       step="0.5" />
            </div>

            <div class="col-md-5">
                <label for="internshipCredits" class="form-label">Elective Credits</label>
                <input type="number"
                       class="form-control"
                       id="internshipCredits"
                       placeholder="a positive number required"
                       value="0"
                       min="0"
                       step="0.5" />
            </div>

            <div class="col-md-2">
                <label for="totalCredits" class="form-label">Total Credits</label>
                <input type="number"
                       class="form-control"
                       id="totalCredits"
                       readonly
                       placeholder="Readonly field" />
            </div>

            <div class="col-12" style="margin-top:20px;">
                <button id="addNewProgramBtn" type="button" class="btn btn-success">Add</button>
                <button id="cancelAddNewProgramBtn" type="button" class="btn btn-outline-danger">Cancel</button>
            </div>
        </div>
    </div>
</div>

@* Filter Modal *@
<div id="filterModal" class="user-modal">
    <div class="user-modal-content">
        <span class="close-modal" id="closeFilterModal">&times;</span>
        <h3>Filter Programs</h3>
        <div class="row g-3" style="margin-top:12px;">
            <div class="col-md-6">
                <label for="filterName" class="form-label">Program name contains</label>
                <input type="text" class="form-control" id="filterName" />
            </div>
            <div class="col-md-3">
                <label for="filterLanguage" class="form-label">Language</label>
                <select class="form-select" id="filterLanguage">
                    <option value="">Any</option>
                    <option value="English">English</option>
                    <option value="Vietnamese">Vietnamese</option>
                    <option value="French">French</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="filterMajorId" class="form-label">Major ID</label>
                <input type="number" min="1" class="form-control" id="filterMajorId" />
            </div>
            <div class="col-md-6">
                <label for="filterFacultyId" class="form-label">Faculty ID</label>
                <input type="number" min="1" class="form-control" id="filterFacultyId" />
            </div>
            <div class="col-12" style="margin-top:8px;">
                <button id="applyFilterBtn" type="button" class="btn btn-primary">Apply</button>
                <button id="clearFilterBtn" type="button" class="btn btn-outline-secondary">Clear</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            // Xử lý hiện/ẩn Add Program Modal
            $("#addProgramBtn").on("click", function () {
                $("#addProgramModal").css("display", "flex");
            });
            $("#closeAddProgramModal").on("click", function () {
                $("#addProgramModal").hide();
            });
            $("#cancelAddNewProgramBtn").on("click", function () {
                $("#addProgramModal").hide();
            });
            $("#addProgramModal").on("click", function (e) {
                if (e.target === this) {
                    $(this).hide();
                }
            });

            $(".view-details").click(function(e) {
                e.preventDefault();
                const programId = $(this).data("id");
                console.log("View program:", programId);
                alert("View program details for ID: " + programId + " (chưa có logic).");
            });

            // Filter modal open/close
            $("#filterProgramsBtn").on("click", function() {
                $("#filterModal").css("display", "flex");
            });
            $("#closeFilterModal").on("click", function() {
                $("#filterModal").hide();
            });
            // Close when clicking outside content
            $("#filterModal").on("click", function(e) {
                if (e.target === this) {
                    $(this).hide();
                }
            });

            // Filter handlers
            $("#applyFilterBtn").on("click", function() {
                const filters = {
                    name: $("#filterName").val(),
                    language: $("#filterLanguage").val(),
                    majorId: $("#filterMajorId").val(),
                    facultyId: $("#filterFacultyId").val()
                };
                console.log("Apply filters:", filters);
                $("#filterModal").hide();
                // TODO: Hook up to server-side filtering or client-side filtering as needed

                // Toggle filter indicator (red dot) if any filter is set
                const anyFilter =
                    (filters.name && filters.name.trim().length > 0) ||
                    (filters.language && filters.language.trim().length > 0) ||
                    (filters.majorId && String(filters.majorId).trim().length > 0) ||
                    (filters.facultyId && String(filters.facultyId).trim().length > 0);

                if (anyFilter) {
                    $("#filterBtn").addClass("has-active-filters");
                } else {
                    $("#filterBtn").removeClass("has-active-filters");
                }
            });
            $("#clearFilterBtn").on("click", function() {
                $("#filterName").val("");
                $("#filterLanguage").val("");
                $("#filterMajorId").val("");
                $("#filterFacultyId").val("");
                $("#filterBtn").removeClass("has-active-filters");
            });

            // Test notifications cho các nút hành động
            $("#searchBtn").click(function () {
                alert("Search button clicked (chưa có logic).");
            });
            // $("#addBtn").click(function () {
            //     alert("Add button clicked (chưa có logic).");
            // });
            $("#editBtn").click(function () {
                alert("Edit button clicked (chưa có logic).");
            });
            $("#deleteBtn").click(function () {
                alert("Delete button clicked (chưa có logic).");
            });


        });
    </script>
}
